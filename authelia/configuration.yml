# =============================================================================
# Authelia Configuration — Single-User Auth Gateway
# =============================================================================
# Docs: https://www.authelia.com/configuration/
#
# NOTE: Uses Authelia's expand-env filter. The DOMAIN env var
# is passed from .env via docker-compose — no manual editing needed.
#

theme: dark

server:
  address: 'tcp://:9091/authelia'

log:
  level: warn

# --- Authentication Backend (file-based, single user) ---
authentication_backend:
  file:
    path: /config/users.yml
    password:
      algorithm: argon2id
      iterations: 3
      memory: 65536
      parallelism: 4
      key_length: 32
      salt_length: 16

# --- Session ---
session:
  name: authelia_session
  cookies:
    - domain: '$DOMAIN'
      authelia_url: 'https://$DOMAIN/authelia'
      default_redirection_url: 'https://$DOMAIN'

# --- Storage (local SQLite) ---
storage:
  local:
    path: /data/db.sqlite3

# --- Notifier (filesystem — no email needed for single user) ---
notifier:
  filesystem:
    filename: /data/notifications.txt

# --- Access Control ---
access_control:
  default_policy: one_factor
  rules:
    # Authelia's own endpoints must be public
    - domain: '$DOMAIN'
      resources:
        - '^/authelia([/?].*)?$'
      policy: bypass
    # robots.txt — block crawlers
    - domain: '$DOMAIN'
      resources:
        - '^/robots\.txt$'
      policy: bypass
    # Everything else requires login
    - domain: '$DOMAIN'
      policy: one_factor

# --- Telemetry (disabled) ---
telemetry:
  metrics:
    enabled: false
